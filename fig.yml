db:
    image: orchardup/postgresql:9.3
    ports:
        - 5432:5432
    environment:
        POSTGRESQL_USER: 'didierio'
        POSTGRESQL_PASS: 'didierio'
        POSTGRESQL_DB: 'didierio'

elasticsearch:
    image: dockerfile/elasticsearch
    ports:
        - 9200:9200
        - 9300:9300

php:
    build: ./docker/php
    links:
        - db:database
        - elasticsearch:search_engine
    ports:
        - 9000:9000
    volumes:
        - website:/srv/http/website
        - connect:/srv/http/connect
        - media/back:/srv/http/media_back
        - docker/php/php-fpm.sh:/php-fpm

website:
    image: nginx
    links:
        - php:webstack_php
    volumes:
        - website:/var/www
        - docker/website/nginx.conf:/nginx.conf
    ports:
        - 80:80
    command: nginx -c /nginx.conf

connect:
    image: nginx
    links:
        - php:webstack_php
        - db:database
    volumes:
        - connect:/var/www
        - docker/connect/nginx.conf:/nginx.conf
    ports:
        - 9002:9002
    command: nginx -c /nginx.conf

mediaBack:
    image: nginx
    links:
        - php:webstack_php
    volumes:
        - media/back:/var/www
        - docker/media_back/nginx.conf:/nginx.conf
    ports:
        - 9003:9003
    command: nginx -c /nginx.conf
